<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Mahjong</title>
  </head>
  <body>
    <form id="set_player_form" action="">
      <select id="set_player_select">
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
      </select>
      <button>Send</button>
    </form>
    <ul id="history_list"></ul>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    <script>
      const socket = io();

      const action_types = [
        "NOTHING",
        "DRAW",
        "DISCARD",
        "CHI_A",
        "CHI_B",
        "CHI_C",
        "PON",
        "OPEN_KAN",
        "ADD_KAN",
        "CLOSED_KAN",
        "FLOWER",
        "RON",
        "TSUMO"
      ];

      const set_player_form = document.getElementById('set_player_form');
      const set_player_select = document.getElementById('set_player_select');
      const history_list = document.getElementById('history_list');

      set_player_form.addEventListener('submit', (e) => {
        e.preventDefault();
        if (set_player_select.value) {
          socket.emit('set_player', set_player_select.value);
        }
      });

      socket.on('list_all', (history_list) => {
        console.log(history_list);
        for (const playeraction of history_list) {
          console.log(playeraction)
          const player = playeraction[0];
          const action = playeraction[1];
          const action_type = action_types[action[0]];
          const tile = action[1];
          const item = document.createElement('li');
          item.textContent = `Player: ${player}, Action: ${action_type}` + 
            (tile != 0 ? `, Tile: ${tile}` : "");
          history_list.appendChild(item);
        }
      });
    </script>
  </body>
</html>